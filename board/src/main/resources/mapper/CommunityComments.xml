<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org/DTD Mapper 3.0/EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="org.iclass.board.mapper.CommunityCommentsMapper">
 <!-- namespace: ì´ ë§¤í¼ë¥¼ êµ¬ë³„í•˜ëŠ” ì´ë¦„í‘œ -->

 <!-- âœ… id=ã…ã…ã…ã…ã… ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì´ ë™ìž‘ í•µì‹¬ -->


	<!-- ê¸€ 1ê±´ ì¡°íšŒ, selectOneByIdx -> ì¸í„°íŽ˜ì´ìŠ¤ ë©”ì„œë“œ ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•¨-->
	<select id="selectOneByIdx" parameterType="Integer" resultType="CommunityCommentsDto">
		SELECT * FROM CommunityComments WHERE idx = #{idx}
		<!-- ðŸ‘‰communityComments í…Œì´ë¸”ì—ì„œ idxê°€ ê°™ì€ í–‰ì„ ê°€ì ¸ì˜´ -->
	</select>

	<!-- ëŒ“ê¸€ ì¶”ê°€ -->
	<insert id="insert" parameterType="CommunityCommentsDto">
		INSERT INTO communityComments (idx, mref, writer, content)
		VALUES (comment_idx_seq.nextval, #{mref}, #{writer}, #{content})
		<!-- #{mref}, #{writer}, #{content}: ìžë°”ì—ì„œ ë„˜ì–´ì˜¨ ê°’ì´ ë“¤ì–´ê°€ëŠ” ìžë¦¬ -->
		<!-- ðŸ‘‰ìƒˆ ëŒ“ê¸€ ì €ìž¥í•˜ê¸° -->
	</insert>

	<!-- ëŒ“ê¸€ ì‚­ì œ -->
	<delete id="delete" parameterType="Integer">
	<!-- parameterType="Integer": ì‚­ì œí•  ëŒ“ê¸€ ë²ˆí˜¸ ì „ë‹¬ -->
		DELETE FROM communityComments c WHERE idx = #{idx}
	<!-- ðŸ‘‰idx(ë²ˆí˜¸)ê°€ ê°™ì€ ëŒ“ê¸€ ì‚­ì œí•´ì¤Œ -->
	</delete>

	<!-- ëŒ“ê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° -->
	<select id="selectCommentList" parameterType="Integer">
	<!--id="selectCommentList": íŠ¹ì • ê¸€ì˜ ëŒ“ê¸€ë“¤ ë³¼ëŸ¬ì˜¤ê¸°, mref(ê¸€ë²ˆí˜¸)ë¥¼ Integerë¡œ ì „ë‹¬-->
		SELECT idx, mref, writer, content, to_char(createdaAt, 'yyyy-mm-dd hh24:mi:ss') regDate, ip
		FROM communityComments c WHERE mref=#{mref}
		ORDER BY idx DESC
		<!-- to_char(createdaAt, 'yyyy-mm-dd hh24:mi:ss') regDate: ë‚ ì§œë¥¼ ë³´ê¸° ì¢‹ê²Œ ë³€í™˜í•˜ê¸° ìœ„í•¨ -->
		<!-- ORDER BY idx DESC: ëŒ“ê¸€ ìµœì‹  ìˆœ ì •ë ¬ -->
		<!-- ðŸ‘‰ë©”ì¸ê¸€ì— ë‹¬ë¦° ëŒ“ê¸€ ëª©ë¡ ë³´ì—¬ì¤Œ -->
	</select>

	<!-- ëŒ“ê¸€ ê°œìˆ˜ ê°€ì ¸ì˜¤ê¸° -->
	<select id="selectCommentCount" parameterType="Integer">
		SELECT count(*) FROM  communityComments c WHERE mref=#{mref}
		<!-- mref(íŠ¹ì • ê¸€ ë²ˆí˜¸)ì— ë‹¬ë¦° ëŒ“ê¸€ì´ ëª‡ ê°œì¸ì§€ ê°œìˆ˜ë§Œ ê°€ì ¸ì˜´. ðŸ‘‰ëŒ“ê¸€ ê°œìˆ˜ ì„¸ê¸°-->
	</select>

	<!-- ë©”ì¸ ê¸€ í…Œì´ë¸”ì˜ ëŒ“ê¸€ ê°œìˆ˜ ì—…ë°ì´íŠ¸ -->
	<update id="updateCommentCount" parameterType="Integer">
	<!-- id="updateCommentCount": ë©”ì¸ ê¸€ì˜ ëŒ“ê¸€ ìˆ˜ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•´ì„œ ì—…ë°ì´íŠ¸ -->
		UPDATE COMMUNITY SET COMMENTCOUNT = 
			(SELECT count(*) FROM communityComments c WHERE mref=#{mref})
		WHERE idx=#{mref}  
		<!-- COMMENTCOUNT ì»¬ëŸ¼: í•´ë‹¹ ê¸€ ë²ˆí˜¸(mref)ì˜ ëŒ“ê¸€ ê°œìˆ˜ -->
		<!-- WHERE idx=#{mref}: ê¸€ ë²ˆí˜¸ ì¼ì¹˜í•˜ëŠ” í–‰ë§Œ ê°œìˆ˜ ìˆ˜ì • -->
		<!-- ðŸ‘‰ëŒ“ê¸€ì´ ì¶”ê°€ë˜ê±°ë‚˜ ì‚­ì œë˜ë©´ ë©”ì¸ê¸€ì˜ ëŒ“ê¸€ ê°œìˆ˜ ì—…ë°ì´íŠ¸ -->
	</update>


</mapper>





 

